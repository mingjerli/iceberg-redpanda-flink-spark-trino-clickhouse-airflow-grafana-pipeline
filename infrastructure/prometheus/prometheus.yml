# =============================================================================
# Prometheus Configuration
# =============================================================================
# Scrape configuration for Iceberg Incremental Demo services.
# =============================================================================

global:
  scrape_interval: 15s
  evaluation_interval: 15s
  external_labels:
    monitor: 'iceberg-demo'

# Alert rules
rule_files:
  - /etc/prometheus/rules/*.yaml

# Alertmanager configuration (optional - uncomment if using Alertmanager)
# alerting:
#   alertmanagers:
#     - static_configs:
#         - targets:
#           - alertmanager:9093

# Scrape configurations
scrape_configs:
  # Prometheus self-monitoring
  - job_name: 'prometheus'
    static_configs:
      - targets: ['localhost:9090']

  # Redpanda/Kafka metrics (public_metrics endpoint)
  - job_name: 'redpanda'
    metrics_path: /public_metrics
    static_configs:
      - targets: ['redpanda:9644']

  # Redpanda internal metrics
  - job_name: 'redpanda-internal'
    metrics_path: /metrics
    static_configs:
      - targets: ['redpanda:9644']

  # MinIO metrics (S3-compatible storage)
  - job_name: 'minio'
    metrics_path: /minio/v2/metrics/cluster
    static_configs:
      - targets: ['minio:9000']

  # Airflow metrics via StatsD exporter
  - job_name: 'airflow'
    static_configs:
      - targets: ['statsd-exporter:9102']

  # Flink metrics (JobManager and TaskManager)
  - job_name: 'flink'
    static_configs:
      - targets: ['flink-jobmanager:9249', 'flink-taskmanager:9249']

  # FastAPI Ingestion API metrics
  - job_name: 'ingestion-api'
    metrics_path: /metrics
    static_configs:
      - targets: ['ingestion-api:8000']
