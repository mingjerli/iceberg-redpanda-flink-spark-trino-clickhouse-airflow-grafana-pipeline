# =============================================================================
# Prometheus Configuration
# =============================================================================
# Scrape configuration for Iceberg Incremental Demo services.
# =============================================================================

global:
  scrape_interval: 15s
  evaluation_interval: 15s
  external_labels:
    monitor: 'iceberg-demo'

# Alert rules
rule_files:
  - /etc/prometheus/rules/*.yaml

# Alertmanager configuration (optional - uncomment if using Alertmanager)
# alerting:
#   alertmanagers:
#     - static_configs:
#         - targets:
#           - alertmanager:9093

# Scrape configurations
scrape_configs:
  # Prometheus self-monitoring
  - job_name: 'prometheus'
    static_configs:
      - targets: ['localhost:9090']

  # MinIO metrics
  - job_name: 'minio'
    metrics_path: /minio/v2/metrics/cluster
    scheme: http
    static_configs:
      - targets: ['minio:9000']

  # Redpanda/Kafka metrics
  - job_name: 'redpanda'
    static_configs:
      - targets: ['redpanda:9644']

  # Flink metrics (JobManager)
  - job_name: 'flink'
    static_configs:
      - targets: ['flink-jobmanager:9249']

  # Spark metrics (if enabled via spark.metrics.conf)
  - job_name: 'spark'
    metrics_path: /metrics/prometheus
    static_configs:
      - targets: ['spark-master:4040']
    # Spark apps may not always be running
    honor_labels: true

  # Airflow metrics (via StatsD exporter or native if configured)
  - job_name: 'airflow'
    static_configs:
      - targets: ['airflow-webserver:8080']
    metrics_path: /health
    # Airflow doesn't expose Prometheus metrics by default
    # This is a placeholder - requires airflow[statsd] or custom exporter

  # Trino metrics
  - job_name: 'trino'
    static_configs:
      - targets: ['trino:8080']
    metrics_path: /v1/info
    # Trino JMX metrics require additional configuration

  # ClickHouse metrics
  - job_name: 'clickhouse'
    static_configs:
      - targets: ['clickhouse:8123']
    metrics_path: /metrics
    # Requires ClickHouse Prometheus endpoint enabled

  # Iceberg REST catalog (basic health)
  - job_name: 'iceberg-rest'
    static_configs:
      - targets: ['iceberg-rest:8181']
    metrics_path: /v1/config
    # This endpoint returns config, not metrics - serves as health check

  # Ingestion API (if metrics endpoint added)
  - job_name: 'ingestion-api'
    static_configs:
      - targets: ['ingestion-api:8090']
    metrics_path: /metrics
    # Requires FastAPI prometheus-fastapi-instrumentator
