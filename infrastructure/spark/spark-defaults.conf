# =============================================================================
# Apache Spark Configuration
# =============================================================================
# Default Spark configuration for batch ETL jobs.
# This file is loaded by Spark when starting.
# =============================================================================

# -----------------------------------------------------------------------------
# Iceberg Catalog Configuration
# -----------------------------------------------------------------------------
spark.sql.extensions                          org.apache.iceberg.spark.extensions.IcebergSparkSessionExtensions
spark.sql.catalog.demo                        org.apache.iceberg.spark.SparkCatalog
spark.sql.catalog.demo.type                   rest
spark.sql.catalog.demo.uri                    http://iceberg-rest:8181
spark.sql.catalog.demo.warehouse              s3a://warehouse/
spark.sql.catalog.demo.io-impl               org.apache.iceberg.aws.s3.S3FileIO
spark.sql.catalog.demo.s3.endpoint           http://minio:9000
spark.sql.catalog.demo.s3.path-style-access  true

# Default catalog
spark.sql.defaultCatalog                      demo

# -----------------------------------------------------------------------------
# S3/MinIO Configuration (via Hadoop S3A)
# -----------------------------------------------------------------------------
spark.hadoop.fs.s3a.endpoint                  http://minio:9000
spark.hadoop.fs.s3a.access.key                admin
spark.hadoop.fs.s3a.secret.key                admin123
spark.hadoop.fs.s3a.path.style.access         true
spark.hadoop.fs.s3a.impl                      org.apache.hadoop.fs.s3a.S3AFileSystem
spark.hadoop.fs.s3a.connection.ssl.enabled    false

# -----------------------------------------------------------------------------
# Performance Tuning
# -----------------------------------------------------------------------------
spark.sql.adaptive.enabled                    true
spark.sql.adaptive.coalescePartitions.enabled true
spark.sql.files.maxPartitionBytes             134217728
spark.sql.shuffle.partitions                  200

# -----------------------------------------------------------------------------
# Iceberg-specific Settings
# -----------------------------------------------------------------------------
spark.sql.catalog.demo.cache-enabled          true
spark.sql.iceberg.handle-timestamp-without-timezone true

# -----------------------------------------------------------------------------
# Resource Configuration
# -----------------------------------------------------------------------------
spark.driver.memory                           2g
spark.executor.memory                         2g
spark.executor.cores                          2

# -----------------------------------------------------------------------------
# History Server (optional)
# -----------------------------------------------------------------------------
# Note: Event logging to S3 is disabled for simplicity in demo environment.
# Enable and configure if Spark History Server is needed.
spark.eventLog.enabled                        false
# spark.eventLog.dir                          s3a://warehouse/spark-events
# spark.history.fs.logDirectory               s3a://warehouse/spark-events

# -----------------------------------------------------------------------------
# Serialization
# -----------------------------------------------------------------------------
spark.serializer                              org.apache.spark.serializer.KryoSerializer
spark.kryoserializer.buffer.max               512m
